@startuml
boundary Endpoint2 order 60
boundary Endpoint1 order 50
box "Captain Hook"
participant EventHandler order 40
collections Reader order 30
participant Director order 20
endbox
boundary ServiceBus order 10

ServiceBus -> Reader : Pick up message from topic
Reader -> ServiceBus : Lock message
Reader -> EventHandler : Spawn handler
group retry (20s, 30s)
  EventHandler -> Endpoint1 : Dispatch message
end
  Endpoint1 -> EventHandler : Read response
group retry (20s, 30s)
  EventHandler -> Endpoint2 : Dispatch response
end
  EventHandler -> Reader : Acknowledge dispatch
  Reader -> ServiceBus : Unlock message
@enduml